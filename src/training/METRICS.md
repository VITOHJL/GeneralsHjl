# 评估指标详解

## 为什么需要多维度评估？

类似量化交易中的"回测表现好，实盘失败"问题，AI也可能出现：
- **训练集表现好，测试集表现差**（过拟合）
- **特定场景表现好，其他场景表现差**（泛化能力差）
- **平均表现好，但稳定性差**（依赖运气）

因此，我们需要**多维度、多层次**的评估体系。

## 评估维度

### 1. 胜负维度（Win Metrics）

#### 胜率（Win Rate）
```
胜率 = 获胜场次 / 总场次
```

**重要性**：最直观的指标，但**不能只看这个**。

**问题**：
- 可能过拟合特定对手
- 可能依赖运气
- 可能只在特定配置下好

**解决方案**：
- 与多种对手测试
- 在不同配置下测试
- 看稳定性指标

#### 存活率（Survival Rate）
```
存活率 = 游戏结束时仍存活的场次 / 总场次
```

**重要性**：即使没赢，存活也说明有韧性。

**应用场景**：
- 多人混战（可能不是第一个被淘汰）
- 长期对抗（能坚持到最后）

### 2. 效率维度（Efficiency Metrics）

#### 每回合移动数（Moves Per Turn）
```
每回合移动数 = 总移动数 / 总回合数
```

**重要性**：衡量AI的活跃度和决策效率。

**好的表现**：
- 高值：AI积极行动，不浪费回合
- 但也要看移动质量（不能盲目移动）

#### 单位利用率（Units Per Move）
```
单位利用率 = 总单位数 / 总移动数
```

**重要性**：衡量移动的"性价比"。

**好的表现**：
- 合理值：既不过度保守（单位堆积），也不过度激进（分散兵力）

#### 领土扩张率（Territory Ratio）
```
领土扩张率 = 最终领土数 / 地图总格子数
```

**重要性**：衡量扩张能力。

**好的表现**：
- 高值：能有效扩张
- 但要结合胜率看（可能扩张太快导致防守薄弱）

### 3. 稳定性维度（Stability Metrics）

#### 标准差（Standard Deviation）
```
标准差 = sqrt(Σ(分数 - 平均分数)² / n)
```

**重要性**：衡量表现的波动性。

**好的表现**：
- 低标准差：表现稳定，不依赖运气
- 高标准差：表现不稳定，可能过拟合或依赖运气

#### 变异系数（Coefficient of Variation）
```
变异系数 = 标准差 / 平均值
```

**重要性**：相对稳定性指标，不受绝对数值影响。

**好的表现**：
- < 0.2：非常稳定
- 0.2-0.3：较稳定
- > 0.3：不稳定，需要关注

#### 分位数（Percentiles）

**P25（25%分位数）**：最差25%的表现
**P75（75%分位数）**：最好25%的表现
**P95（95%分位数）**：极端情况的表现

**重要性**：
- 评估极端情况下的表现
- 评估表现的分布情况

**好的表现**：
- P25和P75差距小：表现稳定
- P95高：极端情况下也能表现好

### 4. 场景维度（Scenario Metrics）

#### 基础场景（Basic Scenarios）
- 标准地图尺寸
- 标准玩家数量
- 标准对手类型

**重要性**：评估在"正常"情况下的表现。

#### 对抗性场景（Adversarial Scenarios）
- 被围攻（多对一）
- 资源劣势（地图更小）
- 长期对抗（大地图）

**重要性**：评估在"不友好"情况下的表现，类似"实盘测试"。

#### 边界场景（Edge Cases）
- 极小地图
- 多人混战
- 极端配置

**重要性**：评估鲁棒性，测试是否会在极端情况下崩溃。

## 综合评分计算

### 权重设计

```
综合评分 = Σ(场景得分 × 权重)
```

权重分配：
- **基础场景：40%** - 正常情况下的表现最重要
- **对抗性测试：30%** - 真实对抗能力
- **边界情况：20%** - 鲁棒性
- **自定义场景：10%** - 特定需求

### 场景得分计算

```
场景得分 = 胜率 × 100 + 平均分数 × 0.1
```

- 胜率权重高（×100）：胜负最重要
- 平均分数权重低（×0.1）：作为补充指标

## 如何判断AI是否有效？

### ✅ 好的AI特征

1. **高胜率**：基础场景 > 60%
2. **稳定性好**：变异系数 < 0.3
3. **对抗性强**：对抗性测试不差于基础场景太多（< 20%差距）
4. **鲁棒性好**：边界情况下不会崩溃（存活率 > 30%）

### ⚠️ 警告信号（可能过拟合）

1. **基础场景很好，对抗性测试很差**
   - 可能过拟合了标准场景
   - 解决方案：增加对抗性测试权重

2. **变异系数很高（> 0.5）**
   - 表现不稳定，可能依赖运气
   - 解决方案：增加测试场次，看是否稳定

3. **分位数差距大（P95 - P25 > 平均值的50%）**
   - 极端情况下表现差异大
   - 解决方案：优化极端情况的处理

4. **只在特定配置下好**
   - 可能过拟合了特定配置
   - 解决方案：增加配置多样性

### ❌ 明显失败的AI

1. **基础场景胜率 < 50%**
   - 连随机AI都打不过，基本无效

2. **对抗性测试胜率 < 20%**
   - 在真实对抗中表现很差

3. **边界情况下经常崩溃**
   - 鲁棒性差，无法实际使用

## 实际应用建议

### 1. 开发阶段

- 使用小样本（10-20场）快速迭代
- 关注基础场景胜率
- 快速发现明显问题

### 2. 验证阶段

- 使用中等样本（50-100场）
- 关注稳定性指标
- 检查是否过拟合

### 3. 发布前

- 使用大样本（200+场）
- 全面评估所有维度
- 确保对抗性测试通过
- 检查边界情况

### 4. 持续监控

- 定期重新评估
- 对比不同版本
- 监控性能退化

## 示例：如何解读评估结果

```
AI评估报告: adaptive
============================================================

综合评分: 72.35

分类评分:
  basic: 75.20        ✅ 基础场景表现好
  adversarial: 68.50  ⚠️ 对抗性测试略差（差距6.7，可接受）
  edgeCases: 71.00    ✅ 边界情况表现稳定
  custom: 70.00        ✅ 自定义场景表现正常

详细场景:

basic:
  地图20x20_2玩家_对手random:
    胜率: 65.0% (65/100)      ✅ 胜率合理
    平均分数: 125.30
    稳定性: 15.20% (变异系数)  ✅ 非常稳定
    平均回合: 45.3

adversarial:
  被围攻场景:
    胜率: 35.0% (35/100)      ⚠️ 被围攻时胜率下降（正常）
    平均分数: 95.20
    稳定性: 18.50% (变异系数)  ✅ 仍然稳定
    平均回合: 38.5
```

**解读**：
- ✅ 基础场景表现好，胜率65%
- ✅ 稳定性很好，变异系数 < 20%
- ⚠️ 对抗性测试略差，但在可接受范围内（被围攻时胜率下降是正常的）
- ✅ 整体评分72.35，属于良好水平

**结论**：这是一个有效的AI，可以投入使用，但可以进一步优化对抗性场景的表现。















